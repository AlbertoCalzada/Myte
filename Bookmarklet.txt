javascript:(function(){'use strict';const MI_HORARIO={LUNES_JUEVES:{ENTRADA:'06:30',SALIDA:'14:00',BREAK_START:'14:00',BREAK_END:'14:30'},VIERNES:{ENTRADA:'06:30',SALIDA:'13:00',BREAK_START:null,BREAK_END:null},TURNO_2:{ACTIVO:true,ENTRADA:'14:30',SALIDA:'16:00'},DELAY_ENTRE_FILAS:1000};let isProcessing=false;const dayNameToNumber={'sun':0,'sunday':0,'dom':0,'domingo':0,'mon':1,'monday':1,'lun':1,'lunes':1,'tue':2,'tuesday':2,'mar':2,'martes':2,'wed':3,'wednesday':3,'mie':3,'miércoles':3,'miercoles':3,'thu':4,'thursday':4,'jue':4,'jueves':4,'fri':5,'friday':5,'vie':5,'viernes':5,'sat':6,'saturday':6,'sab':6,'sábado':6,'sabado':6};function getDayOfWeek(t){if(!t)return-1;const e=t.toLowerCase();for(const[n,o]of Object.entries(dayNameToNumber))if(e.includes(n))return o;return-1}function isWeekday(t){const e=getDayOfWeek(t);return e>=1&&e<=5}function isFriday(t){return 5===getDayOfWeek(t)}function isMondayToThursday(t){const e=getDayOfWeek(t);return e>=1&&e<=4}function sleep(t){return new Promise(e=>setTimeout(e,t))}function getDateTextForRow(t){const e=document.querySelector(`#workingHoursPunchClockGrid .ag-row[row-index="${t}"] [col-id="dateTime"]`);let n='';if(e){const o=e.querySelector('myte-punch-clock-date-cell-renderer');if(o){const r=o.querySelector('div');r&&(n=r.childNodes[0]?.textContent?.trim()||r.textContent.trim().split('\n')[0].trim())}n||(n=e.textContent.trim())}return n}function getRowsData(){const t=[],e=document.querySelectorAll('#workingHoursPunchClockGrid .ag-row[row-index]'),n=new Set;return e.forEach(t=>{const e=t.getAttribute('row-index');null!==e&&n.add(e)}),Array.from(n).map(Number).sort((t,e)=>t-e).forEach(e=>{t.push({rowIndex:e,dateText:getDateTextForRow(e)})}),t}function setCellTime(t,e,n){const o=document.querySelector(`#workingHoursPunchClockGrid .ag-row[row-index="${t}"] [col-id="${e}"]`);if(!o)return!1;const r=o.querySelector('myte-time-cell-renderer');if(!r)return!1;const a=r.querySelector('select[name="hours"]'),i=r.querySelector('select[name="minutes"]');if(!a||!i)return!1;if('-1'!==a.value&&''!==a.value)return!1;const[s,l]=n.split(':').map(t=>parseInt(t,10));return a.value=s.toString(),a.dispatchEvent(new Event('change',{bubbles:!0})),i.value=l.toString(),i.dispatchEvent(new Event('change',{bubbles:!0})),a.dispatchEvent(new Event('blur',{bubbles:!0})),!0}function clearCellTime(t,e){const n=document.querySelector(`#workingHoursPunchClockGrid .ag-row[row-index="${t}"] [col-id="${e}"]`);if(!n)return;const o=n.querySelector('myte-time-cell-renderer');if(!o)return;const r=o.querySelector('select[name="hours"]'),a=o.querySelector('select[name="minutes"]');r&&(r.value='-1',r.dispatchEvent(new Event('change',{bubbles:!0}))),a&&(a.value='-1',a.dispatchEvent(new Event('change',{bubbles:!0})))}function fillRowTurno1(t){const{rowIndex:e,dateText:n}=t;if(!isWeekday(n))return!1;const o=isFriday(n)?MI_HORARIO.VIERNES:MI_HORARIO.LUNES_JUEVES;let r=!1;return setCellTime(e,'workStartTime',o.ENTRADA)&&(r=!0),setCellTime(e,'workEndTime',o.SALIDA)&&(r=!0),o.BREAK_START&&o.BREAK_END&&(setCellTime(e,'mealStartTime',o.BREAK_START)&&(r=!0),setCellTime(e,'mealEndTime',o.BREAK_END)&&(r=!0)),r}function countMondayToThursdayRows(){return getRowsData().filter(t=>isMondayToThursday(t.dateText)).length}function areAllMondayToThursdayComplete(){let t=0,e=0;return getRowsData().forEach(n=>{if(isMondayToThursday(n.dateText)){t++;const o=document.querySelector(`#workingHoursPunchClockGrid .ag-row[row-index="${n.rowIndex}"] [col-id="workStartTime"] select[name="hours"]`);o&&'-1'!==o.value&&''!==o.value&&e++}}),t>0&&t===e}function findAddButton(){return document.querySelector('button.add-button[aria-label="Add new row"]')||document.querySelector('.action-button.add-button')||document.querySelector('button[aria-label*="Add"]')}async function clickAddButtonForRow(t){const e=getRowsData();let n=0;for(const o of e)if(isMondayToThursday(o.dateText)){if(n===t){const t=document.querySelector(`#workingHoursPunchClockGrid .ag-row[row-index="${o.rowIndex}"] myte-punch-clock-action-cell-renderer button.add-button, #workingHoursPunchClockGrid .ag-row[row-index="${o.rowIndex}"] myte-punch-clock-action-cell-renderer button[aria-label*="Add"]`);if(t)return t.click(),!0}n++}const o=findAddButton();return!!o&&(o.click(),!0)}function fillEmptyRows(){const t=document.querySelectorAll('#workingHoursPunchClockGrid .ag-row[row-index]'),e=new Set;t.forEach(t=>{const n=t.getAttribute('row-index');null!==n&&e.add(Number(n))});const n=Array.from(e).sort((t,e)=>t-e),[o,r]=MI_HORARIO.TURNO_2.ENTRADA.split(':').map(Number),[a,i]=MI_HORARIO.TURNO_2.SALIDA.split(':').map(Number);for(const t of n){const e=getDateTextForRow(t),n=getDayOfWeek(e);if(0===n||6===n||5===n)continue;const s=document.querySelector(`#workingHoursPunchClockGrid .ag-row[row-index="${t}"] [col-id="workStartTime"] select[name="hours"]`);if(!s||'-1'!==s.value&&''!==s.value)continue;s.value=o.toString(),s.dispatchEvent(new Event('change',{bubbles:!0}));const l=document.querySelector(`#workingHoursPunchClockGrid .ag-row[row-index="${t}"] [col-id="workStartTime"] select[name="minutes"]`);l&&(l.value=r.toString(),l.dispatchEvent(new Event('change',{bubbles:!0})));const c=document.querySelector(`#workingHoursPunchClockGrid .ag-row[row-index="${t}"] [col-id="workEndTime"] select[name="hours"]`),u=document.querySelector(`#workingHoursPunchClockGrid .ag-row[row-index="${t}"] [col-id="workEndTime"] select[name="minutes"]`);c&&(c.value=a.toString(),c.dispatchEvent(new Event('change',{bubbles:!0}))),u&&(u.value=i.toString(),u.dispatchEvent(new Event('change',{bubbles:!0}))),clearCellTime(t,'mealStartTime'),clearCellTime(t,'mealEndTime')}}async function processAllRows(){if(isProcessing)return;isProcessing=!0;try{const t=getRowsData();for(const e of t)fillRowTurno1(e);const e=countMondayToThursdayRows(),n=areAllMondayToThursdayComplete();if(MI_HORARIO.TURNO_2.ACTIVO&&e>0&&n){for(let t=0;t<e;t++)await clickAddButtonForRow(t)&&await sleep(MI_HORARIO.DELAY_ENTRE_FILAS);await sleep(500),fillEmptyRows()}}finally{isProcessing=!1}}processAllRows();})();
